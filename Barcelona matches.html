<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Bar√ßa Match Hub ¬∑ EA FC 26</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --barca-blue: #004d98;
      --barca-claret: #a50044;
      --barca-gold: #fdb913;
      --barca-bg: #020814;
      --card-bg: rgba(4, 17, 40, 0.95);
      --text-main: #f5f5f5;
      --text-muted: #a0aec0;
      --border-soft: rgba(255, 255, 255, 0.08);
      --input-bg: rgba(3, 22, 46, 0.95);
      --win: #16a34a;
      --draw: #9ca3af;
      --loss: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1a3358 0, var(--barca-bg) 45%, #01030a 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    header {
      background: linear-gradient(90deg, var(--barca-claret), var(--barca-blue));
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-symbol {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--barca-gold), #ffeaa7);
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.6);
      position: relative;
      overflow: hidden;
    }

    .logo-symbol::before,
    .logo-symbol::after {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: 9px;
      border: 2px solid rgba(0, 0, 0, 0.7);
    }

    .logo-title-main {
      font-weight: 800;
      font-size: 1.1rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .logo-title-sub {
      font-size: 0.75rem;
      opacity: 0.9;
    }

    .header-badge {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      background: rgba(0, 0, 0, 0.2);
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    main {
      padding: 16px;
      max-width: 1200px;
      margin: 0 auto 32px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.9fr);
      gap: 16px;
    }

    @media (max-width: 960px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 14px 14px 12px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(18px);
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 0.98rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .card-pill {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.85;
    }

    .card-description {
      font-size: 0.76rem;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .section-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
    }

    .form-row {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }

    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 0.78rem;
    }

    label {
      color: var(--text-muted);
      font-size: 0.73rem;
    }

    input[type="text"],
    input[type="number"],
    select {
      background: var(--input-bg);
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 7px 11px;
      color: var(--text-main);
      font-size: 0.8rem;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      border-color: var(--barca-gold);
      box-shadow: 0 0 0 1px rgba(253, 185, 19, 0.5);
      background: rgba(4, 30, 72, 0.95);
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] { -moz-appearance: textfield; }

    button {
      border-radius: 999px;
      border: none;
      padding: 7px 12px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, var(--barca-gold), #ffe27a);
      color: #3b2800;
      box-shadow: 0 7px 18px rgba(0, 0, 0, 0.7);
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
      white-space: nowrap;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 9px 22px rgba(0, 0, 0, 0.8);
      filter: brightness(1.05);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 5px 14px rgba(0, 0, 0, 0.75);
      filter: brightness(0.96);
    }

    .button-secondary {
      background: transparent;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      box-shadow: none;
    }

    .button-secondary:hover {
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(13, 30, 63, 0.9);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.6);
    }

    .status {
      margin-top: 4px;
      font-size: 0.75rem;
    }
    .status.success { color: #22c55e; }
    .status.error   { color: #f97373; }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      padding: 2px 8px;
      font-size: 0.7rem;
      background: rgba(0, 0, 0, 0.35);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chip-name {
      max-width: 120px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chip button {
      padding: 0 5px;
      font-size: 0.7rem;
      box-shadow: none;
    }

    .soft-divider {
      height: 1px;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.24), transparent 65%);
      opacity: 0.5;
      margin: 6px 0;
    }

    .table-wrapper {
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      margin-top: 6px;
      background: rgba(2, 11, 26, 0.95);
      overflow-x: auto;
      overflow-y: hidden;
    }

    table {
      width: 100%;
      min-width: 750px;
      border-collapse: collapse;
      font-size: 0.78rem;
    }

    thead {
      background: linear-gradient(90deg, rgba(165, 0, 68, 0.9), rgba(0, 77, 152, 0.9));
    }

    th, td {
      padding: 6px 8px;
      text-align: right;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      white-space: nowrap;
    }

    th:first-child,
    td:first-child {
      text-align: left;
    }

    tbody tr:nth-child(even) {
      background: rgba(4, 16, 35, 0.92);
    }

    tbody tr:nth-child(odd) {
      background: rgba(5, 22, 48, 0.92);
    }

    tbody tr:hover {
      background: rgba(12, 39, 82, 0.96);
    }

    .empty-state {
      padding: 10px;
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .filters-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 4px;
      font-size: 0.76rem;
      flex-wrap: wrap;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(0, 0, 0, 0.35);
      color: var(--text-muted);
    }

    .result-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.72rem;
      font-weight: 600;
    }

    .result-win {
      background: rgba(22, 163, 74, 0.15);
      color: var(--win);
      border: 1px solid rgba(22, 163, 74, 0.6);
    }

    .result-draw {
      background: rgba(148, 163, 184, 0.15);
      color: var(--draw);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .result-loss {
      background: rgba(248, 113, 113, 0.15);
      color: var(--loss);
      border: 1px solid rgba(248, 113, 113, 0.6);
    }

    .stat-tag {
      font-size: 0.72rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.14);
    }

    .summary-line {
      font-size: 0.78rem;
      margin-top: 6px;
      color: var(--text-muted);
    }

    .file-input {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    @media (max-width: 600px) {
      header {
        padding: 10px 12px;
      }
      .logo-title-main { font-size: 1rem; }
      .logo-title-sub { font-size: 0.68rem; }
      .header-badge { display: none; }

      main {
        padding: 10px 8px 20px;
        max-width: 100%;
        margin: 0 auto 24px;
        grid-template-columns: minmax(0, 1fr);
        gap: 12px;
      }

      .card {
        padding: 12px 10px;
        border-radius: 14px;
      }

      .card-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .form-row {
        flex-direction: column;
      }

      .filters-row {
        flex-direction: column;
        align-items: flex-start;
      }

      table {
        font-size: 0.7rem;
        min-width: 680px;
      }

      th, td {
        padding: 4px 6px;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="logo">
    <div class="logo-symbol"></div>
    <div>
      <div class="logo-title-main">BAR√áA MATCH HUB</div>
      <div class="logo-title-sub">EA FC 26 ‚Äî –º–∞—Ç—á–∏, —Ç—É—Ä–Ω–∏—Ä—ã, —Å–æ–ø–µ—Ä–Ω–∏–∫–∏</div>
    </div>
  </div>
  <div class="header-badge">
    <span>üîí</span>
    <span>localStorage + —ç–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–∞–π–ª</span>
  </div>
</header>

<main>
  <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ + –≤–≤–æ–¥ –º–∞—Ç—á–∞ + –±—ç–∫–∞–ø -->
  <section class="section-grid">
    <!-- –¢—É—Ä–Ω–∏—Ä—ã -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          üèÜ –¢—É—Ä–Ω–∏—Ä—ã
          <span class="card-pill">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</span>
        </div>
      </div>
      <p class="card-description">
        –î–æ–±–∞–≤—å —Ç—É—Ä–Ω–∏—Ä—ã (–õ–∞ –õ–∏–≥–∞, –õ–ß, –ö—É–±–æ–∫ –∏ —Ç.–ø.), —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –≤—ã–±–∏—Ä–∞—Ç—å –∏—Ö –ø—Ä–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –º–∞—Ç—á–∞.
      </p>
      <form id="tournamentForm">
        <div class="form-row">
          <div class="form-group">
            <label for="tournamentName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞</label>
            <input type="text" id="tournamentName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–∞ –õ–∏–≥–∞" />
          </div>
          <div class="form-group" style="flex:0 0 auto; align-self:flex-end;">
            <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </form>
      <div class="soft-divider"></div>
      <div class="chips" id="tournamentChips"></div>
      <div class="status" id="tournamentStatus"></div>
    </div>

    <!-- –°–æ–ø–µ—Ä–Ω–∏–∫–∏ -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          ü§ù –°–æ–ø–µ—Ä–Ω–∏–∫–∏
          <span class="card-pill">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</span>
        </div>
      </div>
      <p class="card-description">
        –ó–¥–µ—Å—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥-—Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤. –ü–æ—Ç–æ–º —Å–º–æ–∂–µ—à—å —Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å—Ç—Ä–µ—á —Å –∫–∞–∂–¥–æ–π –∏–∑ –Ω–∏—Ö.
      </p>
      <form id="opponentForm">
        <div class="form-row">
          <div class="form-group">
            <label for="opponentName">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</label>
            <input type="text" id="opponentName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–µ–∞–ª –ú–∞–¥—Ä–∏–¥" />
          </div>
          <div class="form-group" style="flex:0 0 auto; align-self:flex-end;">
            <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </form>
      <div class="soft-divider"></div>
      <div class="chips" id="opponentChips"></div>
      <div class="status" id="opponentStatus"></div>
    </div>

    <!-- –í–≤–æ–¥ –º–∞—Ç—á–∞ -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          ‚öΩ –ú–∞—Ç—á
          <span class="card-pill">–í–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</span>
        </div>
      </div>
      <p class="card-description">
        –í–Ω–µ—Å–∏ —Å—ã–≥—Ä–∞–Ω–Ω—ã–π –º–∞—Ç—á: —Å–µ–∑–æ–Ω, —Ç—É—Ä–Ω–∏—Ä, —Å–æ–ø–µ—Ä–Ω–∏–∫ –∏ —Å—á—ë—Ç. –†–µ–∑—É–ª—å—Ç–∞—Ç (–ü–æ–±–µ–¥–∞/–ù–∏—á—å—è/–ü–æ—Ä–∞–∂–µ–Ω–∏–µ) –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
      </p>
      <form id="matchForm">
        <div class="form-row">
          <div class="form-group" style="flex:0 0 90px;">
            <label for="matchSeason">–°–µ–∑–æ–Ω</label>
            <select id="matchSeason"></select>
          </div>
          <div class="form-group">
            <label for="matchTournament">–¢—É—Ä–Ω–∏—Ä</label>
            <select id="matchTournament"></select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="matchOpponent">–°–æ–ø–µ—Ä–Ω–∏–∫</label>
            <select id="matchOpponent"></select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="goalsFor">–ó–∞–±–∏—Ç—ã–µ (–ë–∞—Ä—Å–∞)</label>
            <input type="number" id="goalsFor" min="0" step="1" placeholder="0" />
          </div>
          <div class="form-group">
            <label for="goalsAgainst">–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ</label>
            <input type="number" id="goalsAgainst" min="0" step="1" placeholder="0" />
          </div>
          <div class="form-group" style="flex:0 0 auto; align-self:flex-end;">
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∞—Ç—á</button>
          </div>
        </div>
      </form>
      <div class="status" id="matchStatus"></div>
    </div>

    <!-- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
          <span class="card-pill">–≠–∫—Å–ø–æ—Ä—Ç / –∏–º–ø–æ—Ä—Ç</span>
        </div>
      </div>
      <p class="card-description">
        –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π —Ç—É—Ä–Ω–∏—Ä—ã, —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤ –∏ –≤—Å–µ –º–∞—Ç—á–∏ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª. –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤—Å—ë –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è, –¥–∞–∂–µ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
      </p>
      <div class="form-row" style="flex-wrap:wrap; gap:8px;">
        <button type="button" id="exportBtn">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <label class="file-input">
          ‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:
          <input type="file" id="importFile" accept="application/json,.json" />
        </label>
      </div>
      <p style="margin-top:6px; font-size:0.75rem; color:var(--text-muted);">
        –§–∞–π–ª: <code>barca_matches_backup.json</code>. –ò–º–ø–æ—Ä—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Ç–µ–∫—É—â–∏–µ —Ç—É—Ä–Ω–∏—Ä—ã, —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤ –∏ –º–∞—Ç—á–∏.
      </p>
    </div>
  </section>

  <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ç–∞–±–ª–∏—Ü—ã –∏ –∏—Å—Ç–æ—Ä–∏—è —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤ -->
  <section class="section-grid">
    <!-- –¢–∞–±–ª–∏—Ü–∞ –º–∞—Ç—á–µ–π -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          üìã –ú–∞—Ç—á–∏
          <span class="card-pill">–°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</span>
        </div>
      </div>
      <p class="card-description">
        –í—Å–µ —Å—ã–≥—Ä–∞–Ω–Ω—ã–µ –º–∞—Ç—á–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç—É—Ä–Ω–∏—Ä–∞, —Å–æ–ø–µ—Ä–Ω–∏–∫–∞, —Å—á—ë—Ç–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∞—Ç—á.
      </p>
      <div class="filters-row">
        <div class="form-group" style="margin-bottom:0; max-width:110px;">
          <label for="filterSeason">–°–µ–∑–æ–Ω</label>
          <select id="filterSeason"></select>
        </div>
        <div class="form-group" style="margin-bottom:0; max-width:150px;">
          <label for="filterTournament">–¢—É—Ä–Ω–∏—Ä</label>
          <select id="filterTournament"></select>
        </div>
        <div class="form-group" style="margin-bottom:0; max-width:150px;">
          <label for="filterOpponent">–°–æ–ø–µ—Ä–Ω–∏–∫</label>
          <select id="filterOpponent"></select>
        </div>
        <span class="badge">–§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É</span>
      </div>
      <div class="table-wrapper" id="matchesTableWrapper">
        <div class="empty-state">–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç. –í–Ω–µ—Å–∏ –ø–µ—Ä–≤—ã–π –º–∞—Ç—á —Å–ª–µ–≤–∞.</div>
      </div>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è —Å —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–º -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          üîç –ò—Å—Ç–æ—Ä–∏—è —Å —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–º
          <span class="card-pill">Head-to-head</span>
        </div>
      </div>
      <p class="card-description">
        –í—ã–±–µ—Ä–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –∏ —Å–º–æ—Ç—Ä–∏ –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –≤—Å—Ç—Ä–µ—á: –º–∞—Ç—á–∏, —Å—á—ë—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç + —Å–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.
      </p>
      <div class="filters-row">
        <div class="form-group" style="margin-bottom:0; min-width:180px;">
          <label for="h2hOpponent">–°–æ–ø–µ—Ä–Ω–∏–∫</label>
          <select id="h2hOpponent"></select>
        </div>
      </div>
      <div class="table-wrapper" id="h2hTableWrapper">
        <div class="empty-state">–í—ã–±–µ—Ä–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∞—Ç—á–µ–π.</div>
      </div>
      <div class="summary-line" id="h2hSummary"></div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–µ–∑–æ–Ω–∞–º/—Ç—É—Ä–Ω–∏—Ä–∞–º/—Å—É–º–º–∞—Ä–Ω–æ -->
    <div class="card" style="grid-column: 1 / -1;">
      <div class="card-header">
        <div class="card-title">
          üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
          <span class="card-pill">–°–µ–∑–æ–Ω—ã ¬∑ –¢—É—Ä–Ω–∏—Ä—ã ¬∑ –ò—Ç–æ–≥–æ</span>
        </div>
      </div>
      <p class="card-description">
        –°–º–æ—Ç—Ä–∏ –±–∞–ª–∞–Ω—Å –ø–æ–±–µ–¥/–Ω–∏—á—å–∏—Ö/–ø–æ—Ä–∞–∂–µ–Ω–∏–π, –∑–∞–±–∏—Ç—ã–µ –∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –º—è—á–∏ –ø–æ —Å–µ–∑–æ–Ω–∞–º, –ø–æ —Ç—É—Ä–Ω–∏—Ä–∞–º –∏ —Å—É–º–º–∞—Ä–Ω–æ.
      </p>
      <div class="filters-row">
        <span class="stat-tag">–ú ‚Äî –ú–∞—Ç—á–∏</span>
        <span class="stat-tag">–í / –ù / –ü ‚Äî –ø–æ–±–µ–¥—ã, –Ω–∏—á—å–∏, –ø–æ—Ä–∞–∂–µ–Ω–∏—è</span>
        <span class="stat-tag">+ / ‚àí ‚Äî –∑–∞–±–∏—Ç—ã–µ / –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ</span>
        <span class="stat-tag">Œî ‚Äî —Ä–∞–∑–Ω–∏—Ü–∞ –º—è—á–µ–π</span>
      </div>

      <h4 style="font-size:0.8rem; margin:6px 0 2px 4px;">–ü–æ —Å–µ–∑–æ–Ω–∞–º</h4>
      <div class="table-wrapper" id="seasonStatsWrapper">
        <div class="empty-state">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞.</div>
      </div>

      <h4 style="font-size:0.8rem; margin:10px 0 2px 4px;">–ü–æ —Ç—É—Ä–Ω–∏—Ä–∞–º</h4>
      <div class="table-wrapper" id="tournamentStatsWrapper">
        <div class="empty-state">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞.</div>
      </div>

      <h4 style="font-size:0.8rem; margin:10px 0 2px 4px;">–°—É–º–º–∞—Ä–Ω–æ</h4>
      <div class="table-wrapper" id="totalStatsWrapper">
        <div class="empty-state">–ú–∞—Ç—á–µ–π –µ—â—ë –Ω–µ—Ç.</div>
      </div>
    </div>
  </section>
</main>

<script>
  // ----- –ö–ª—é—á–∏ localStorage -----
  const STORAGE_KEYS = {
    tournaments: "fc26_match_tournaments",
    opponents: "fc26_match_opponents",
    matches: "fc26_match_matches",
  };

  // ----- –°–æ—Å—Ç–æ—è–Ω–∏–µ -----
  let tournaments = [];
  let opponents = [];
  let matches = [];

  // ----- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ -----
  function createId() {
    return Date.now().toString(36) + Math.random().toString(36).substring(2, 8);
  }

  function loadFromStorage() {
    try {
      const tRaw = localStorage.getItem(STORAGE_KEYS.tournaments);
      const oRaw = localStorage.getItem(STORAGE_KEYS.opponents);
      const mRaw = localStorage.getItem(STORAGE_KEYS.matches);

      tournaments = tRaw ? JSON.parse(tRaw) : [];
      opponents = oRaw ? JSON.parse(oRaw) : [];
      matches = mRaw ? JSON.parse(mRaw) : [];
    } catch (e) {
      console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage", e);
      tournaments = [];
      opponents = [];
      matches = [];
    }
  }

  function saveTournaments() {
    localStorage.setItem(STORAGE_KEYS.tournaments, JSON.stringify(tournaments));
  }
  function saveOpponents() {
    localStorage.setItem(STORAGE_KEYS.opponents, JSON.stringify(opponents));
  }
  function saveMatches() {
    localStorage.setItem(STORAGE_KEYS.matches, JSON.stringify(matches));
  }

  function getTournamentName(id) {
    const t = tournaments.find(t => t.id === id);
    return t ? t.name : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä";
  }

  function getOpponentName(id) {
    const o = opponents.find(o => o.id === id);
    return o ? o.name : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–æ–ø–µ—Ä–Ω–∏–∫";
  }

  function parseIntOrZero(value) {
    const n = parseInt(value, 10);
    return isNaN(n) ? 0 : n;
  }

  function calcResult(goalsFor, goalsAgainst) {
    if (goalsFor > goalsAgainst) return "win";
    if (goalsFor < goalsAgainst) return "loss";
    return "draw";
  }

  function resultText(code) {
    switch (code) {
      case "win": return "–ü–æ–±–µ–¥–∞";
      case "draw": return "–ù–∏—á—å—è";
      case "loss": return "–ü–æ—Ä–∞–∂–µ–Ω–∏–µ";
      default: return "";
    }
  }

  function resultClass(code) {
    switch (code) {
      case "win": return "result-pill result-win";
      case "draw": return "result-pill result-draw";
      case "loss": return "result-pill result-loss";
      default: return "result-pill";
    }
  }

  // ----- –≠–∫—Å–ø–æ—Ä—Ç / –∏–º–ø–æ—Ä—Ç -----
  function exportData() {
    const data = {
      tournaments,
      opponents,
      matches,
      exportedAt: new Date().toISOString(),
      version: "1.0"
    };
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "barca_matches_backup.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function importDataFromFile(file) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        if (!data || !Array.isArray(data.tournaments) || !Array.isArray(data.opponents) || !Array.isArray(data.matches)) {
          alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞: –Ω–µ—Ç tournaments/opponents/matches.");
          return;
        }
        tournaments = data.tournaments;
        opponents = data.opponents;
        matches = data.matches;

        saveTournaments();
        saveOpponents();
        saveMatches();

        populateSeasonSelects();
        renderTournaments();
        renderOpponents();
        renderMatchesTable();
        renderH2H();
        renderAllStats();

        alert("–î–∞–Ω–Ω—ã–µ –º–∞—Ç—á–µ–π —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!");
      } catch (err) {
        console.error(err);
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –±—ç–∫–∞–ø–∞. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JSON.");
      }
    };
    reader.readAsText(file, "utf-8");
  }

  // ----- –†–µ–Ω–¥–µ—Ä —Å–µ–ª–µ–∫—Ç–æ–≤ —Å–µ–∑–æ–Ω–æ–≤/—Ñ–∏–ª—å—Ç—Ä–æ–≤ -----
  function populateSeasonSelects() {
    const matchSeason = document.getElementById("matchSeason");
    const filterSeason = document.getElementById("filterSeason");
    matchSeason.innerHTML = "";
    filterSeason.innerHTML = "";

    for (let i = 1; i <= 15; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = i;
      matchSeason.appendChild(opt);
    }

    const optAll = document.createElement("option");
    optAll.value = "all";
    optAll.textContent = "–í—Å–µ";
    filterSeason.appendChild(optAll);
    for (let i = 1; i <= 15; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = i;
      filterSeason.appendChild(opt);
    }
    filterSeason.value = "all";
  }

  // ----- –¢—É—Ä–Ω–∏—Ä—ã -----
  function renderTournaments() {
    const chips = document.getElementById("tournamentChips");
    const selectMatch = document.getElementById("matchTournament");
    const selectFilter = document.getElementById("filterTournament");

    chips.innerHTML = "";
    selectMatch.innerHTML = "";
    selectFilter.innerHTML = "";

    const optAll = document.createElement("option");
    optAll.value = "all";
    optAll.textContent = "–í—Å–µ —Ç—É—Ä–Ω–∏—Ä—ã";
    selectFilter.appendChild(optAll);

    if (!tournaments.length) {
      const none = document.createElement("option");
      none.value = "";
      none.textContent = "–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å —Ç—É—Ä–Ω–∏—Ä";
      selectMatch.appendChild(none);
    } else {
      tournaments
        .slice()
        .sort((a, b) => a.name.localeCompare(b.name, "ru"))
        .forEach((t) => {
          const chip = document.createElement("div");
          chip.className = "chip";
          const span = document.createElement("span");
          span.className = "chip-name";
          span.textContent = t.name;
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "button-secondary";
          btn.textContent = "‚úï";
          btn.addEventListener("click", () => {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä "${t.name}"? –ú–∞—Ç—á–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –±—É–¥—É—Ç –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä.`)) return;
            tournaments = tournaments.filter(x => x.id !== t.id);
            saveTournaments();
            renderTournaments();
            renderMatchesTable();
            renderTournamentStats();
          });
          chip.appendChild(span);
          chip.appendChild(btn);
          chips.appendChild(chip);

          const opt1 = document.createElement("option");
          opt1.value = t.id;
          opt1.textContent = t.name;
          selectMatch.appendChild(opt1);

          const opt2 = document.createElement("option");
          opt2.value = t.id;
          opt2.textContent = t.name;
          selectFilter.appendChild(opt2);
        });
    }
  }

  // ----- –°–æ–ø–µ—Ä–Ω–∏–∫–∏ -----
  function renderOpponents() {
    const chips = document.getElementById("opponentChips");
    const selectMatch = document.getElementById("matchOpponent");
    const selectFilter = document.getElementById("filterOpponent");
    const selectH2H = document.getElementById("h2hOpponent");

    chips.innerHTML = "";
    selectMatch.innerHTML = "";
    selectFilter.innerHTML = "";
    selectH2H.innerHTML = "";

    const optAllFilter = document.createElement("option");
    optAllFilter.value = "all";
    optAllFilter.textContent = "–í—Å–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∏";
    selectFilter.appendChild(optAllFilter);

    const optH2HPlaceholder = document.createElement("option");
    optH2HPlaceholder.value = "";
    optH2HPlaceholder.textContent = "–í—ã–±–µ—Ä–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞";
    selectH2H.appendChild(optH2HPlaceholder);

    if (!opponents.length) {
      const none = document.createElement("option");
      none.value = "";
      none.textContent = "–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å —Å–æ–ø–µ—Ä–Ω–∏–∫–∞";
      selectMatch.appendChild(none);
    } else {
      opponents
        .slice()
        .sort((a, b) => a.name.localeCompare(b.name, "ru"))
        .forEach((o) => {
          const chip = document.createElement("div");
          chip.className = "chip";
          const span = document.createElement("span");
          span.className = "chip-name";
          span.textContent = o.name;
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "button-secondary";
          btn.textContent = "‚úï";
          btn.addEventListener("click", () => {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ "${o.name}"? –ú–∞—Ç—á–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –±—É–¥—É—Ç –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–æ–ø–µ—Ä–Ω–∏–∫.`)) return;
            opponents = opponents.filter(x => x.id !== o.id);
            saveOpponents();
            renderOpponents();
            renderMatchesTable();
            renderH2H();
            renderAllStats();
          });
          chip.appendChild(span);
          chip.appendChild(btn);
          chips.appendChild(chip);

          const opt1 = document.createElement("option");
          opt1.value = o.id;
          opt1.textContent = o.name;
          selectMatch.appendChild(opt1);

          const opt2 = document.createElement("option");
          opt2.value = o.id;
          opt2.textContent = o.name;
          selectFilter.appendChild(opt2);

          const opt3 = document.createElement("option");
          opt3.value = o.id;
          opt3.textContent = o.name;
          selectH2H.appendChild(opt3);
        });
    }
  }

  // ----- –¢–∞–±–ª–∏—Ü–∞ –º–∞—Ç—á–µ–π -----
  function renderMatchesTable() {
    const wrapper = document.getElementById("matchesTableWrapper");
    wrapper.innerHTML = "";

    if (!matches.length) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.";
      wrapper.appendChild(empty);
      renderAllStats();
      return;
    }

    const seasonFilter = document.getElementById("filterSeason").value;
    const tournamentFilter = document.getElementById("filterTournament").value;
    const opponentFilter = document.getElementById("filterOpponent").value;

    let rows = matches
      .slice()
      .map(m => ({ ...m }))
      .sort((a, b) => {
        if (a.season === b.season) {
          return a.id.localeCompare(b.id);
        }
        return a.season - b.season;
      });

    if (seasonFilter !== "all") {
      const s = parseInt(seasonFilter, 10);
      rows = rows.filter(r => r.season === s);
    }
    if (tournamentFilter !== "all") {
      rows = rows.filter(r => r.tournamentId === tournamentFilter);
    }
    if (opponentFilter !== "all") {
      rows = rows.filter(r => r.opponentId === opponentFilter);
    }

    if (!rows.length) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "–ü–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –º–∞—Ç—á–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.";
      wrapper.appendChild(empty);
      renderAllStats();
      return;
    }

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    const headerRow = document.createElement("tr");
    const headers = ["–°–µ–∑–æ–Ω", "–¢—É—Ä–Ω–∏—Ä", "–°–æ–ø–µ—Ä–Ω–∏–∫", "–°—á—ë—Ç", "–†–µ–∑—É–ª—å—Ç–∞—Ç", ""];
    headers.forEach((h) => {
      const th = document.createElement("th");
      th.textContent = h;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    rows.forEach((m) => {
      const tr = document.createElement("tr");

      const seasonTd = document.createElement("td");
      seasonTd.textContent = m.season;
      tr.appendChild(seasonTd);

      const tourTd = document.createElement("td");
      tourTd.textContent = getTournamentName(m.tournamentId);
      tr.appendChild(tourTd);

      const oppTd = document.createElement("td");
      oppTd.textContent = getOpponentName(m.opponentId);
      tr.appendChild(oppTd);

      const scoreTd = document.createElement("td");
      scoreTd.textContent = `${m.goalsFor}:${m.goalsAgainst}`;
      tr.appendChild(scoreTd);

      const resultCode = calcResult(m.goalsFor, m.goalsAgainst);
      const resultTd = document.createElement("td");
      const span = document.createElement("span");
      span.className = resultClass(resultCode);
      span.textContent = resultText(resultCode);
      resultTd.appendChild(span);
      tr.appendChild(resultTd);

      const actionsTd = document.createElement("td");
      actionsTd.style.textAlign = "center";
      const delBtn = document.createElement("button");
      delBtn.type = "button";
      delBtn.className = "button-secondary";
      delBtn.textContent = "‚úï";
      delBtn.title = "–£–¥–∞–ª–∏—Ç—å –º–∞—Ç—á";
      delBtn.style.padding = "2px 8px";
      delBtn.style.fontSize = "0.7rem";
      delBtn.addEventListener("click", () => {
        if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç—á?")) return;
        matches = matches.filter(x => x.id !== m.id);
        saveMatches();
        renderMatchesTable();
        renderH2H();
        renderAllStats();
      });
      actionsTd.appendChild(delBtn);
      tr.appendChild(actionsTd);

      tbody.appendChild(tr);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    wrapper.appendChild(table);

    renderAllStats();
  }

  // ----- –ò—Å—Ç–æ—Ä–∏—è —Å —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–º -----
  function renderH2H() {
    const select = document.getElementById("h2hOpponent");
    const wrapper = document.getElementById("h2hTableWrapper");
    const summaryEl = document.getElementById("h2hSummary");

    wrapper.innerHTML = "";
    summaryEl.textContent = "";

    const opponentId = select.value;
    if (!opponentId) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "–í—ã–±–µ—Ä–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∞—Ç—á–µ–π.";
      wrapper.appendChild(empty);
      return;
    }

    const h2hMatches = matches
      .filter(m => m.opponentId === opponentId)
      .sort((a, b) => a.season - b.season);

    if (!h2hMatches.length) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "–° —ç—Ç–∏–º —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–º –µ—â—ë –Ω–µ –∏–≥—Ä–∞–ª–∏.";
      wrapper.appendChild(empty);
      return;
    }

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    const hr = document.createElement("tr");
    ["–°–µ–∑–æ–Ω", "–¢—É—Ä–Ω–∏—Ä", "–°—á—ë—Ç", "–†–µ–∑—É–ª—å—Ç–∞—Ç"].forEach(h => {
      const th = document.createElement("th");
      th.textContent = h;
      hr.appendChild(th);
    });
    thead.appendChild(hr);

    let wins = 0, draws = 0, losses = 0, gf = 0, ga = 0;

    h2hMatches.forEach(m => {
      const tr = document.createElement("tr");

      const seasonTd = document.createElement("td");
      seasonTd.textContent = m.season;
      tr.appendChild(seasonTd);

      const tourTd = document.createElement("td");
      tourTd.textContent = getTournamentName(m.tournamentId);
      tr.appendChild(tourTd);

      const scoreTd = document.createElement("td");
      scoreTd.textContent = `${m.goalsFor}:${m.goalsAgainst}`;
      tr.appendChild(scoreTd);

      const resultCode = calcResult(m.goalsFor, m.goalsAgainst);
      const rTd = document.createElement("td");
      const span = document.createElement("span");
      span.className = resultClass(resultCode);
      span.textContent = resultText(resultCode);
      rTd.appendChild(span);
      tr.appendChild(rTd);

      tbody.appendChild(tr);

      gf += m.goalsFor;
      ga += m.goalsAgainst;
      if (resultCode === "win") wins++;
      else if (resultCode === "draw") draws++;
      else if (resultCode === "loss") losses++;
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    wrapper.appendChild(table);

    const oppName = getOpponentName(opponentId);
    const total = h2hMatches.length;
    const diff = gf - ga;
    const sign = diff > 0 ? "+" : diff < 0 ? "‚àí" : "¬±";
    const diffStr = diff === 0 ? "0" : Math.abs(diff);

    summaryEl.textContent =
      `–ü—Ä–æ—Ç–∏–≤ ${oppName}: –ú${total}, –í${wins}, –ù${draws}, –ü${losses}, ` +
      `–º—è—á–∏ ${gf}:${ga} (${sign}${diffStr}).`;
  }

  // ----- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -----
  function renderSeasonStats() {
    const wrapper = document.getElementById("seasonStatsWrapper");
    wrapper.innerHTML = "";

    if (!matches.length) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.";
      wrapper.appendChild(empty);
      return;
    }

    const bySeason = {};
    matches.forEach(m => {
      if (!bySeason[m.season]) {
        bySeason[m.season] = {
          matches: 0, wins: 0, draws: 0, losses: 0, gf: 0, ga: 0
        };
      }
      const s = bySeason[m.season];
      s.matches++;
      s.gf += m.goalsFor;
      s.ga += m.goalsAgainst;
      const r = calcResult(m.goalsFor, m.goalsAgainst);
      if (r === "win") s.wins++;
      else if (r === "draw") s.draws++;
      else if (r === "loss") s.losses++;
    });

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    const hr = document.createElement("tr");
    ["–°–µ–∑–æ–Ω", "–ú", "–í", "–ù", "–ü", "+", "‚àí", "Œî"].forEach(h => {
      const th = document.createElement("th");
      th.textContent = h;
      hr.appendChild(th);
    });
    thead.appendChild(hr);

    Object.keys(bySeason)
      .map(k => parseInt(k, 10))
      .sort((a, b) => a - b)
      .forEach(season => {
        const s = bySeason[season];
        const tr = document.createElement("tr");
        const diff = s.gf - s.ga;
        const diffText = diff > 0 ? "+" + diff : diff < 0 ? diff.toString() : "0";

        const cells = [
          season,
          s.matches,
          s.wins,
          s.draws,
          s.losses,
          s.gf,
          s.ga,
          diffText
        ];
        cells.forEach((val, idx) => {
          const td = document.createElement("td");
          if (idx === 0) td.style.textAlign = "left";
          td.textContent = val;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

    table.appendChild(thead);
    table.appendChild(tbody);
    wrapper.appendChild(table);
  }

  function renderTournamentStats() {
    const wrapper = document.getElementById("tournamentStatsWrapper");
    wrapper.innerHTML = "";

    if (!matches.length) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.";
      wrapper.appendChild(empty);
      return;
    }

    const byTournament = {};
    matches.forEach(m => {
      const key = m.tournamentId || "unknown";
      if (!byTournament[key]) {
        byTournament[key] = {
          matches: 0, wins: 0, draws: 0, losses: 0, gf: 0, ga: 0
        };
      }
      const t = byTournament[key];
      t.matches++;
      t.gf += m.goalsFor;
      t.ga += m.goalsAgainst;
      const r = calcResult(m.goalsFor, m.goalsAgainst);
      if (r === "win") t.wins++;
      else if (r === "draw") t.draws++;
      else if (r === "loss") t.losses++;
    });

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    const hr = document.createElement("tr");
    ["–¢—É—Ä–Ω–∏—Ä", "–ú", "–í", "–ù", "–ü", "+", "‚àí", "Œî"].forEach(h => {
      const th = document.createElement("th");
      th.textContent = h;
      hr.appendChild(th);
    });
    theead = thead;
    thead.appendChild(hr);

    Object.keys(byTournament)
      .map(id => id)
      .sort((a, b) => getTournamentName(a).localeCompare(getTournamentName(b), "ru"))
      .forEach(id => {
        const t = byTournament[id];
        const tr = document.createElement("tr");
        const diff = t.gf - t.ga;
        const diffText = diff > 0 ? "+" + diff : diff < 0 ? diff.toString() : "0";

        const name = getTournamentName(id);

        const cells = [
          name,
          t.matches,
          t.wins,
          t.draws,
          t.losses,
          t.gf,
          t.ga,
          diffText
        ];
        cells.forEach((val, idx) => {
          const td = document.createElement("td");
          if (idx === 0) td.style.textAlign = "left";
          td.textContent = val;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

    table.appendChild(thead);
    table.appendChild(tbody);
    wrapper.appendChild(table);
  }

  function renderTotalStats() {
    const wrapper = document.getElementById("totalStatsWrapper");
    wrapper.innerHTML = "";

    if (!matches.length) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.";
      wrapper.appendChild(empty);
      return;
    }

    let matchesCount = 0, wins = 0, draws = 0, losses = 0, gf = 0, ga = 0;

    matches.forEach(m => {
      matchesCount++;
      gf += m.goalsFor;
      ga += m.goalsAgainst;
      const r = calcResult(m.goalsFor, m.goalsAgainst);
      if (r === "win") wins++;
      else if (r === "draw") draws++;
      else if (r === "loss") losses++;
    });

    const diff = gf - ga;
    const diffText = diff > 0 ? "+" + diff : diff < 0 ? diff.toString() : "0";

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    const hr = document.createElement("tr");
    ["", "–ú", "–í", "–ù", "–ü", "+", "‚àí", "Œî"].forEach(h => {
      const th = document.createElement("th");
      th.textContent = h;
      hr.appendChild(th);
    });
    thead.appendChild(hr);

    const tr = document.createElement("tr");
    const cells = [
      "–ò—Ç–æ–≥–æ",
      matchesCount,
      wins,
      draws,
      losses,
      gf,
      ga,
      diffText
    ];
    cells.forEach((val, idx) => {
      const td = document.createElement("td");
      if (idx === 0) td.style.textAlign = "left";
      td.textContent = val;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);

    table.appendChild(thead);
    table.appendChild(tbody);
    wrapper.appendChild(table);
  }

  function renderAllStats() {
    renderSeasonStats();
    renderTournamentStats();
    renderTotalStats();
  }

  // ----- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º -----
  function initForms() {
    // —Ç—É—Ä–Ω–∏—Ä
    const tForm = document.getElementById("tournamentForm");
    const tInput = document.getElementById("tournamentName");
    const tStatus = document.getElementById("tournamentStatus");

    tForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = tInput.value.trim();
      if (!name) {
        tStatus.textContent = "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.";
        tStatus.className = "status error";
        return;
      }
      const exists = tournaments.some(t => t.name.toLowerCase() === name.toLowerCase());
      if (exists) {
        tStatus.textContent = "–¢–∞–∫–æ–π —Ç—É—Ä–Ω–∏—Ä —É–∂–µ –µ—Å—Ç—å.";
        tStatus.className = "status error";
        return;
      }
      tournaments.push({ id: createId(), name });
      saveTournaments();
      renderTournaments();
      tInput.value = "";
      tStatus.textContent = "–¢—É—Ä–Ω–∏—Ä –¥–æ–±–∞–≤–ª–µ–Ω.";
      tStatus.className = "status success";
    });

    // —Å–æ–ø–µ—Ä–Ω–∏–∫
    const oForm = document.getElementById("opponentForm");
    const oInput = document.getElementById("opponentName");
    const oStatus = document.getElementById("opponentStatus");

    oForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = oInput.value.trim();
      if (!name) {
        oStatus.textContent = "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.";
        oStatus.className = "status error";
        return;
      }
      const exists = opponents.some(o => o.name.toLowerCase() === name.toLowerCase());
      if (exists) {
        oStatus.textContent = "–¢–∞–∫–æ–π —Å–æ–ø–µ—Ä–Ω–∏–∫ —É–∂–µ –µ—Å—Ç—å.";
        oStatus.className = "status error";
        return;
      }
      opponents.push({ id: createId(), name });
      saveOpponents();
      renderOpponents();
      oInput.value = "";
      oStatus.textContent = "–°–æ–ø–µ—Ä–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω.";
      oStatus.className = "status success";
    });

    // –º–∞—Ç—á
    const mForm = document.getElementById("matchForm");
    const mStatus = document.getElementById("matchStatus");

    mForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const season = parseIntOrZero(document.getElementById("matchSeason").value);
      const tournamentId = document.getElementById("matchTournament").value;
      const opponentId = document.getElementById("matchOpponent").value;
      const goalsFor = parseIntOrZero(document.getElementById("goalsFor").value);
      const goalsAgainst = parseIntOrZero(document.getElementById("goalsAgainst").value);

      if (!tournamentId) {
        mStatus.textContent = "–í—ã–±–µ—Ä–∏ —Ç—É—Ä–Ω–∏—Ä.";
        mStatus.className = "status error";
        return;
      }
      if (!opponentId) {
        mStatus.textContent = "–í—ã–±–µ—Ä–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞.";
        mStatus.className = "status error";
        return;
      }

      const match = {
        id: createId(),
        season,
        tournamentId,
        opponentId,
        goalsFor,
        goalsAgainst
      };
      matches.push(match);
      saveMatches();
      renderMatchesTable();
      renderH2H();
      mStatus.textContent = "–ú–∞—Ç—á —Å–æ—Ö—Ä–∞–Ω—ë–Ω.";
      mStatus.className = "status success";

      document.getElementById("goalsFor").value = "";
      document.getElementById("goalsAgainst").value = "";
    });

    document.getElementById("filterSeason").addEventListener("change", renderMatchesTable);
    document.getElementById("filterTournament").addEventListener("change", renderMatchesTable);
    document.getElementById("filterOpponent").addEventListener("change", renderMatchesTable);

    document.getElementById("h2hOpponent").addEventListener("change", renderH2H);

    // —ç–∫—Å–ø–æ—Ä—Ç / –∏–º–ø–æ—Ä—Ç
    const exportBtn = document.getElementById("exportBtn");
    const importFileInput = document.getElementById("importFile");

    if (exportBtn) {
      exportBtn.addEventListener("click", exportData);
    }

    if (importFileInput) {
      importFileInput.addEventListener("change", (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file) {
          e.target.value = "";
          return;
        }
        const ok = confirm("–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—É—â—É—é –±–∞–∑—É –º–∞—Ç—á–µ–π?");
        if (!ok) {
          e.target.value = "";
          return;
        }
        importDataFromFile(file);
        e.target.value = "";
      });
    }
  }

  // ----- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -----
  document.addEventListener("DOMContentLoaded", () => {
    loadFromStorage();
    populateSeasonSelects();
    renderTournaments();
    renderOpponents();
    renderMatchesTable();
    renderH2H();
    renderAllStats();
    initForms();
  });
</script>
</body>
</html>
